
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Sim/">
      
      
        <link rel="next" href="../Recovery/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>Move_Base_Flex - Robot Rescue</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#move-base-flex" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Robot Rescue" class="md-header__button md-logo" aria-label="Robot Rescue" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Robot Rescue
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Move_Base_Flex
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Robot Rescue" class="md-nav__button md-logo" aria-label="Robot Rescue" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Robot Rescue
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Setup/" class="md-nav__link">
        Setup
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" tabindex="0" aria-expanded="false">
          Simultation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Simultation" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Simultation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../URDF/" class="md-nav__link">
        Mod√®le
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../TF/" class="md-nav__link">
        Transformations
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3_3" tabindex="0" aria-expanded="false">
          Gazebo
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Gazebo" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Gazebo
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Plugins/" class="md-nav__link">
        Plugins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Sim/" class="md-nav__link">
        Simulation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" tabindex="0" aria-expanded="true">
          Navigation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Navigation" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Navigation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Move_Base_Flex
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Move_Base_Flex
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#global-costmap" class="md-nav__link">
    Global Costmap
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-costmap" class="md-nav__link">
    Local Costmap
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#global-planner" class="md-nav__link">
    Global Planner
  </a>
  
    <nav class="md-nav" aria-label="Global Planner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#action-get_path" class="md-nav__link">
    Action /get_path
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_2" tabindex="0" aria-expanded="false">
          Recovery
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Recovery" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Recovery
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Recovery/" class="md-nav__link">
        Recovery Plugins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Recovery_Plugin/" class="md-nav__link">
        Plugin Custum
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Bt/" class="md-nav__link">
        Behavior Tree
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../MultiMachine/" class="md-nav__link">
        Multi Machine
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#global-costmap" class="md-nav__link">
    Global Costmap
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-costmap" class="md-nav__link">
    Local Costmap
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#global-planner" class="md-nav__link">
    Global Planner
  </a>
  
    <nav class="md-nav" aria-label="Global Planner">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#action-get_path" class="md-nav__link">
    Action /get_path
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="move-base-flex">Move base Flex</h1>
<p>Move_base_flex est un composant ROS (Robot Operating System) utilis√© pour la planification de la navigation autonome dans un environnement de robot. Il fournit une solution pour la planification de la navigation autonome en utilisant des algorithmes de planification de la trajectoire et de la gestion de la carte de co√ªts.</p>
<p><img alt="Image title" src="../images/move_base_flex.png" /></p>
<p>MoveBaseFlex est une extension de la biblioth√®que de navigation de base de ROS (Robot Operating System), qui est √©galement appel√©e MoveBase. MoveBaseFlex h√©rite du fonctionnement de base de MoveBase, mais ajoute des fonctionnalit√©s suppl√©mentaires pour prendre en charge diff√©rents algorithmes de planification et de suivi de chemin pour les robots mobiles.</p>
<p>MoveBaseFlex est con√ßu pour √™tre plus flexible que MoveBase et peut √™tre utilis√© pour des sc√©narios de navigation plus complexes. Il permet de changer facilement les algorithmes de planification et de suivi de chemin en fonction des besoins sp√©cifiques de l'application, sans avoir √† modifier le code source.</p>
<p>Voir -&gt; <a href="https://uos.github.io/mbf_docs/">Documentation Move_Base_Flex</a></p>
<p>Pour realiser une navigation flexible est adpat√© a notre besoin nous allons nous ajouter nos propre plugin qui vont ensuite √™tre appeler par les serveur move_base_flex</p>
<p><img alt="Image title" src="../images/Move_base_flex_plugin.png" /></p>
<h2 id="global-costmap">Global Costmap</h2>
<p>La carte fournie par un Lidar ezst utulis√© par le Global Costmap. Le co√ªt associ√© √† chaque pixel de la carte est d√©termin√© par la planification de chemin et l'√©vitement d'obstacles. Plus pr√©cis√©ment, le Global Costmap utilise des donn√©es de capteurs pour d√©tecter les obstacles et les ajouter √† la carte, en assignant un co√ªt √©lev√© √† ces zones pour indiquer aux algorithmes de planification de chemin qu'il est pr√©f√©rable de les √©viter. Le Global Costmap est utilis√© pour g√©n√©rer des chemins s√ªrs pour le robot en fonction de son environnement actuel.</p>
<p>Le Global Costmap est une carte √† grande √©chelle qui repr√©sente l'environnement dans son ensemble, en incluant des obstacles d√©termin√©s par les capteurs du robot. Cette carte est utilis√©e pour planifier des chemins √† long terme pour le robot en √©vitant les obstacles.</p>
<p><img alt="Image title" src="../images/Nav/GlobalMapInlfation.png" /></p>
<table>
<thead>
<tr>
<th>Param√®tre</th>
<th>Valeur</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>global_frame</code></td>
<td><code>map</code></td>
</tr>
<tr>
<td><code>robot_base_frame</code></td>
<td><code>base_footprint</code></td>
</tr>
<tr>
<td><code>update_frequency</code></td>
<td><code>10.0</code></td>
</tr>
<tr>
<td><code>publish_frequency</code></td>
<td><code>10.0</code></td>
</tr>
<tr>
<td><code>transform_tolerance</code></td>
<td><code>10</code></td>
</tr>
<tr>
<td><code>static_map</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>latch_xy_goal_tolerance</code></td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>inflation_radius</code></td>
<td><code>0.35</code></td>
</tr>
<tr>
<td><code>cost_scaling_factor</code></td>
<td><code>0.1</code></td>
</tr>
</tbody>
</table>
<h2 id="local-costmap">Local Costmap</h2>
<p>Le local_costmap est une partie du syst√®me de navigation ROS qui permet √† un robot de construire et maintenir une carte locale de son environnement imm√©diat. Ce local_costmap utilise souvent des donn√©es provenant d'un capteur LiDAR (ou Laser Detection and Ranging) pour mesurer la distance aux obstacles dans son environnement. Les donn√©es du LiDAR sont utilis√©es pour cr√©er une carte 2D de la r√©gion environnante, o√π chaque pixel repr√©sente la distance √† un obstacle ou un espace libre. Cette carte est ensuite utilis√©e par l'algorithme de navigation pour planifier un chemin de mani√®re √† √©viter les obstacles.</p>
<p>Le local_costmap est g√©n√©ralement d√©fini avec un certain nombre de param√®tres, tels que la fr√©quence de mise √† jour, la taille de la fen√™tre roulante, la r√©solution, l'inflation des obstacles, etc. qui d√©terminent comment les donn√©es du LiDAR sont utilis√©es pour construire et maintenir la carte locale. En g√©n√©ral, l'objectif est de fournir une repr√©sentation pr√©cise et √† jour de l'environnement du robot pour aider √† la planification de son chemin de mani√®re s√ªre et efficace.</p>
<table>
<thead>
<tr>
<th>Param√®tre</th>
<th>Valeur</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>global_frame</code></td>
<td><code>odom</code></td>
</tr>
<tr>
<td><code>robot_base_frame</code></td>
<td><code>base_footprint</code></td>
</tr>
<tr>
<td><code>update_frequency</code></td>
<td><code>10.0</code></td>
</tr>
<tr>
<td><code>publish_frequency</code></td>
<td><code>10.0</code></td>
</tr>
<tr>
<td><code>transform_tolerance</code></td>
<td><code>10</code></td>
</tr>
<tr>
<td><code>rolling_window</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>width</code></td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>height</code></td>
<td><code>3</code></td>
</tr>
<tr>
<td><code>resolution</code></td>
<td><code>0.05</code></td>
</tr>
<tr>
<td><code>latch_xy_goal_tolerance</code></td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>inflation_radius</code></td>
<td><code>0.2</code></td>
</tr>
<tr>
<td><code>cost_scaling_factor</code></td>
<td><code>0.2</code></td>
</tr>
</tbody>
</table>
<h2 id="global-planner">Global Planner</h2>
<p>Le Global Planner est responsable de la planification du chemin global pour un robot mobile pour aller d'un point de d√©part √† un point d'arriv√©e. Il utilise une carte de co√ªt pour √©valuer les diff√©rents chemins possibles et en d√©duire le plus optimal. Il peut utiliser des algorithmes de planification de chemin tels que l'algorithme A * ou Dijkstra pour trouver le chemin optimal. Le Global Planner est g√©n√©ralement utilis√© en conjonction avec le Local Planner pour former un syst√®me complet de navigation pour les robots mobiles.</p>
<p>Voir -&gt; <a href="http://wiki.ros.org/global_planner">Documentation Global Planner</a></p>
<p>Ce plugin peut etre appeler en utilisant le service /make plan ou grace √† l'action /get_path</p>
<h3 id="action-get_path">Action /get_path</h3>
<p>Voici un exemple de code Python qui souscrit au topic /move_base_simple/goal et publie la cible dans l'action /get_path</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span> <span class="nn">rospy</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span> <span class="nn">actionlib</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">PoseStamped</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">from</span> <span class="nn">move_base_msgs.msg</span> <span class="kn">import</span> <span class="n">GetPathAction</span><span class="p">,</span> <span class="n">GetPathGoal</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="k">class</span> <span class="nc">MoveBaseFlex</span><span class="p">:</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">sub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="s2">&quot;/move_base_simple/goal&quot;</span><span class="p">,</span> <span class="n">PoseStamped</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">)</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">actionlib</span><span class="o">.</span><span class="n">SimpleActionClient</span><span class="p">(</span><span class="s1">&#39;move_base_flex/get_path&#39;</span><span class="p">,</span> <span class="n">GetPathAction</span><span class="p">)</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="k">def</span> <span class="nf">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">wait_for_server</span><span class="p">()</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>        <span class="n">goal</span> <span class="o">=</span> <span class="n">GetPathGoal</span><span class="p">()</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>        <span class="n">goal</span><span class="o">.</span><span class="n">target_pose</span> <span class="o">=</span> <span class="n">msg</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">send_goal</span><span class="p">(</span><span class="n">goal</span><span class="p">)</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s1">&#39;move_base_flex_node&#39;</span><span class="p">)</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    <span class="n">mbf</span> <span class="o">=</span> <span class="n">MoveBaseFlex</span><span class="p">()</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">spin</span><span class="p">()</span>
</code></pre></div>
<p>Dans le Global Planner de ROS, le "cost_factor" (facteur de co√ªt) est un param√®tre qui d√©termine le niveau de pond√©ration des co√ªts associ√©s √† chaque cellule de la "costmap". Il s'agit d'un nombre √† virgule flottant avec une valeur par d√©faut de 3.0. Il peut influencer le comportement du planificateur en termes de pr√©f√©rence pour certain pixels sur la carte.</p>
<p><img alt="Image title" src="../images/Nav/CostFactorsGlobalPlanner.png" /></p>
<p>Le cost_factor indique √† quel point une cellule sera √©vit√©e par le planificateur de chemin durant la planification de la trajectoire pour atteindre la destination souhait√©e.</p>
<p>Un co√ªt facteur √©lev√© indique que la cellule est consid√©r√©e comme difficile √† traverser et sera donc √©vit√©e par le planificateur de chemin. Inversement, un co√ªt facteur faible indique que la cellule est consid√©r√©e comme facile √† traverser et sera donc favoris√©e par le planificateur de chemin.</p>
<p>Attention de si le cost_factor est trop faible, il risque de cr√©er des paths erron√©es:
<img alt="Image title" src="../images/Nav/CostFactor0_1and0_2.png" />
Ci-dessus avec un costMap de 0.1, la path gener√© ne d√©bute pas au niveau du robot</p>
<div class="highlight"><pre><span></span><code>source devel/setup.bash
export TURTLEBOT3_MODEL=rescue
roslaunch turtlebot3_gazebo turtlebot3_world.launch
</code></pre></div>
<h2 id="_1"></h2>
<div class="highlight"><pre><span></span><code>source devel/setup.bash
export TURTLEBOT3_MODEL=rescue
roslaunch mbf_advanced amcl_demo_mbf_recovery.launch
</code></pre></div>
<h2 id="_2"></h2>
<div class="highlight"><pre><span></span><code>source devel/setup.bash
rosrun mbf_advanced pytreesRecovery.py
</code></pre></div>
<h2 id="_3"></h2>
<div class="highlight"><pre><span></span><code>rosrun rqt_py_trees rqt_py_trees
</code></pre></div>
<h1 id="move-base-client">Move base Client</h1>
<p>Le launch file suivant lance  "move_base_flex". Ce noeud appartient au package "mbf_costmap_nav" et utilise le type "mbf_costmap_nav".</p>
<p>Le noeud charge plusieurs fichiers de param√®tres ROS √† l'aide de la commande "rosparam". Les fichiers de param√®tres d√©finissent les comportements du noeud "move_base_flex", tels que les param√®tres de co√ªts pour les cartes locales et globales de l'environnement ainsi que les param√®tres de planification de la base locale. Les param√®tres de r√©cup√©ration "move_base_flex_recovery" sont √©galement charg√©s pour d√©finir les comportements de r√©cup√©ration.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="w">  </span><span class="nt">&lt;node</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;move_base_flex&quot;</span><span class="w"> </span><span class="na">pkg=</span><span class="s">&quot;mbf_costmap_nav&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;mbf_costmap_nav&quot;</span><span class="w"> </span><span class="na">required=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="na">output=</span><span class="s">&quot;screen&quot;</span><span class="w"> </span><span class="na">clear_params=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="nt">&lt;rosparam</span><span class="w"> </span><span class="na">file=</span><span class="s">&quot;$(find mbf_advanced)/param/move_base_classic/costmap_common_params_$(arg model).yaml&quot;</span><span class="w"> </span><span class="na">command=</span><span class="s">&quot;load&quot;</span><span class="w"> </span><span class="na">ns=</span><span class="s">&quot;global_costmap&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="nt">&lt;rosparam</span><span class="w"> </span><span class="na">file=</span><span class="s">&quot;$(find mbf_advanced)/param/move_base_classic/costmap_common_params_$(arg model).yaml&quot;</span><span class="w"> </span><span class="na">command=</span><span class="s">&quot;load&quot;</span><span class="w"> </span><span class="na">ns=</span><span class="s">&quot;local_costmap&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="nt">&lt;rosparam</span><span class="w"> </span><span class="na">file=</span><span class="s">&quot;$(find mbf_advanced)/param/move_base_classic/local_costmap_params.yaml&quot;</span><span class="w"> </span><span class="na">command=</span><span class="s">&quot;load&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="nt">&lt;rosparam</span><span class="w"> </span><span class="na">file=</span><span class="s">&quot;$(find mbf_advanced)/param/move_base_classic/global_costmap_params.yaml&quot;</span><span class="w"> </span><span class="na">command=</span><span class="s">&quot;load&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="nt">&lt;rosparam</span><span class="w"> </span><span class="na">file=</span><span class="s">&quot;$(find mbf_advanced)/param/move_base_flex_recovery.yaml&quot;</span><span class="w"> </span><span class="na">command=</span><span class="s">&quot;load&quot;</span><span class="nt">/&gt;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">    </span><span class="nt">&lt;rosparam</span><span class="w"> </span><span class="na">file=</span><span class="s">&quot;$(find mbf_advanced)/param/move_base_classic/base_local_planner_params.yaml&quot;</span><span class="w"> </span><span class="na">command=</span><span class="s">&quot;load&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">  </span><span class="nt">&lt;/node&gt;</span>
</code></pre></div>
<p>Nous incluons les different param√®tre necessaire pour parametre nos plugins</p>
<p>La premiere etape et de se soscrire au topic poseStamped qui peremt d'envyer un goal
et d'envoyer ce goal a move base en utilisant les action de action lib</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="ch">#!/usr/bin/env python</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="kn">import</span> <span class="nn">actionlib</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="kn">import</span> <span class="nn">rospy</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="kn">import</span> <span class="nn">nav_msgs.srv</span> <span class="k">as</span> <span class="nn">nav_srvs</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="kn">import</span> <span class="nn">mbf_msgs.msg</span> <span class="k">as</span> <span class="nn">mbf_msgs</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="kn">import</span> <span class="nn">move_base_msgs.msg</span> <span class="k">as</span> <span class="nn">mb_msgs</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="kn">from</span> <span class="nn">geometry_msgs.msg</span> <span class="kn">import</span> <span class="n">PoseStamped</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="k">def</span> <span class="nf">simple_goal_cb</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    <span class="n">mbf_mb_ac</span><span class="o">.</span><span class="n">send_goal</span><span class="p">(</span><span class="n">mbf_msgs</span><span class="o">.</span><span class="n">MoveBaseGoal</span><span class="p">(</span><span class="n">target_pose</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">logdebug</span><span class="p">(</span><span class="s2">&quot;Relaying move_base_simple/goal pose to mbf&quot;</span><span class="p">)</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>    <span class="n">mbf_mb_ac</span><span class="o">.</span><span class="n">wait_for_result</span><span class="p">()</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>    <span class="n">status</span> <span class="o">=</span> <span class="n">mbf_mb_ac</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">mbf_mb_ac</span><span class="o">.</span><span class="n">get_result</span><span class="p">()</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">logdebug</span><span class="p">(</span><span class="s2">&quot;MBF execution completed with result [</span><span class="si">%d</span><span class="s2">]: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">outcome</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s2">&quot;move_base_relay&quot;</span><span class="p">)</span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>    <span class="c1"># move base flex ation client relays incoming mb goals to mbf</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a>    <span class="n">mbf_mb_ac</span> <span class="o">=</span> <span class="n">actionlib</span><span class="o">.</span><span class="n">SimpleActionClient</span><span class="p">(</span><span class="s2">&quot;move_base_flex/move_base&quot;</span><span class="p">,</span> <span class="n">mbf_msgs</span><span class="o">.</span><span class="n">MoveBaseAction</span><span class="p">)</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>    <span class="n">mbf_mb_ac</span><span class="o">.</span><span class="n">wait_for_server</span><span class="p">(</span><span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a>    <span class="c1"># move_base simple topic and action server</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a>    <span class="n">mb_sg</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="s1">&#39;move_base_simple/goal&#39;</span><span class="p">,</span> <span class="n">PoseStamped</span><span class="p">,</span> <span class="n">simple_goal_cb</span><span class="p">)</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">on_shutdown</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">mbf_mb_ac</span><span class="o">.</span><span class="n">cancel_all_goals</span><span class="p">())</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a>    <span class="n">rospy</span><span class="o">.</span><span class="n">spin</span><span class="p">()</span><span class="n">sd</span>
</code></pre></div>
<p>Explication du code:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">mb_sg</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="s1">&#39;move_base_simple/goal&#39;</span><span class="p">,</span> <span class="n">PoseStamped</span><span class="p">,</span> <span class="n">simple_goal_cb</span><span class="p">)</span>
</code></pre></div>
<p>On cr√©er un subsciber "mb_sb" qui souscit au topic "move_base_simple/goal" de type PoseStamped dont le CallBack et la fonction simple_goal_cb</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">mbf_mb_ac</span> <span class="o">=</span> <span class="n">actionlib</span><span class="o">.</span><span class="n">SimpleActionClient</span><span class="p">(</span><span class="s2">&quot;move_base_flex/move_base&quot;</span><span class="p">,</span> <span class="n">mbf_msgs</span><span class="o">.</span><span class="n">MoveBaseAction</span><span class="p">)</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">mbf_mb_ac</span><span class="o">.</span><span class="n">wait_for_server</span><span class="p">(</span><span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
</code></pre></div>
<p>On instancit un client mbf_mb_ac  qui va se connecter au node (serveur) /move_base_flex  avec commme action :
/move_base_flex/move_base</p>
<p>Le node move_base_flex dispose de plusieur action (fichier source dans /move_base_flex/mbf_abstract_nav/src/move_base_action.cpp)</p>
<p>Whatch py_tree doc
http://docs.ros.org/en/kinetic/api/py_trees_ros/html/tutorials.html</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "content.code.copy"], "search": "../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>